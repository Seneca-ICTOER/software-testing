"use strict";(self.webpackChunksft211=self.webpackChunksft211||[]).push([[351],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return p}});var a=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),h=u(n),p=s,f=h["".concat(l,".").concat(p)]||h[p]||d[p]||o;return n?a.createElement(f,r(r({ref:t},c),{},{components:n})):a.createElement(f,r({ref:t},c))}));function p(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=n.length,r=new Array(o);r[0]=h;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:s,r[1]=i;for(var u=2;u<o;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},4940:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return c},default:function(){return h}});var a=n(7462),s=n(3366),o=(n(7294),n(3905)),r=["components"],i={id:"vs-test-2",title:"Unit Testing in Visual Studio",sidebar_position:2,description:"TBD"},l="Unit Testing in Visual Studio",u={unversionedId:"C-UnitTesting/vs-test-2",id:"C-UnitTesting/vs-test-2",isDocsHomePage:!1,title:"Unit Testing in Visual Studio",description:"TBD",source:"@site/docs/C-UnitTesting/vs-unit-2.md",sourceDirName:"C-UnitTesting",slug:"/C-UnitTesting/vs-test-2",permalink:"/C-UnitTesting/vs-test-2",editUrl:"https://github.com/Seneca-ICTOER/software-testing/tree/main/docs/C-UnitTesting/vs-unit-2.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"vs-test-2",title:"Unit Testing in Visual Studio",sidebar_position:2,description:"TBD"},sidebar:"courseNotesSidebar",previous:{title:"Unit Testing",permalink:"/C-UnitTesting/unit-testing-1"},next:{title:"Testing Coverage",permalink:"/C-UnitTesting/testing-coverage-3"}},c=[{value:"mathfuncs.h",id:"mathfuncsh",children:[],level:3},{value:"mathfuncs.c",id:"mathfuncsc",children:[],level:3},{value:"Accessing the Software Under Test",id:"accessing-the-software-under-test",children:[],level:2},{value:"Running the Tests",id:"running-the-tests",children:[],level:2},{value:"Setting Up and Tearing Down Tests",id:"setting-up-and-tearing-down-tests",children:[],level:2}],d={toc:c};function h(e){var t=e.components,i=(0,s.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"unit-testing-in-visual-studio"},"Unit Testing in Visual Studio"),(0,o.kt)("p",null,"Visual Studio provides its own test framework for C and C++ programs. The framework is written in C++, but can be adapted to test C code as well as C++ code. While the framework can be used to test any existing project, one of the common ways to use the test framework is to add the test code itself as a new project to the solution that is under test. We will look at testing the following code."),(0,o.kt)("h3",{id:"mathfuncsh"},"mathfuncs.h"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-C"},"#pragma once\n#ifndef MATHFUNCS_H\n#define MATHFUNCS_H\n\ndouble square(double n);\ndouble cube(double n);\n\n#endif\n")),(0,o.kt)("h3",{id:"mathfuncsc"},"mathfuncs.c"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-C"},'#include "mathfuncs.h"\n\ndouble square(double n)\n{\n    return n * n;\n}\n\ndouble cube(double n)\n{\n    return n * n * n;\n}\n')),(0,o.kt)("p",null,"As you can see, we create two functions: one to square a number and another to cube a number. Testing that these functions work is a simple matter but seeing how it is done will illustrate all the steps in creating a test project for an existing project."),(0,o.kt)("p",null,"Open the project you want to test and then click on the name of the solution at the top of the solution explorer. Then, from the File menu select New | Project. This will display the new project menu and you should select a native unit test project for C++ on Windows, as shown below."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"&quot;Dialog to create a unit testing project in Visual Studio&quot; ",src:n(470).Z})),(0,o.kt)("p",null,"Once the project has been created, you will see it at the bottom of the solution explorer. They have already written a skeleton unit test program for you called UnitTest1.cpp (or whatever name you selected). I have modified this file to look as shown below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-C"},'#include "pch.h"\n#include "CppUnitTest.h"\n#include "mathfuncs_r.h"\n\nusing namespace Microsoft::VisualStudio::CppUnitTestFramework;\n\nnamespace MathTestSuite\n{\n    TEST_CLASS(MathTest)\n    {\n    public:\n\n        TEST_METHOD(SquareTest)\n        {\n            double d = square(8.0);\n            Assert::AreEqual(64.0, d);\n        }\n\n        TEST_METHOD(CubeTest)\n        {\n            double d = cube(3.0);\n            Assert::AreEqual(27.0, d);\n        }\n    };\n\n    TEST_CLASS(MathIntegrationTest)\n    {\n    public:\n\n        TEST_METHOD(AdditionTest)\n        {\n            double d = square(8.0);\n            double d1 = cube(3.0);\n            Assert::AreEqual(91.0, d + d1);\n        }\n    };\n}\n')),(0,o.kt)("p",null,"I modified the namespace to be more meaningful and called it ",(0,o.kt)("strong",{parentName:"p"},"MathTestSuite"),". Within the namespace, I have created two classes. Each class would usually represent the tests for a single function or feature. Placing tests in classes provides a convenient way to group tests together. Inside each class, there are test methods which each test one particular aspect of the code. In this example, I have one class to test the functions and a second class to test how the functions might work together. There is no set way to do this and you are encouraged to layout your tests in the most organized fashion you can for your particular project."),(0,o.kt)("p",null,"Inside the tests, you call your functions with specific values and then use an assertion to determine if the result is correct by comparing it to a known value. The Assert class has many methods that allow you to compare values. If the two values pass the comparison, the test passes, otherwise it fails."),(0,o.kt)("p",null,"The methods of the Assert class are summarized in the following table."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:"left"},"Method"),(0,o.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"AreEqual(v1, v2 ",'[, "error message"]'," )"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Compares v1 to v2 and throws an exception if they are not equal. If they are not equal, the optional error string will be displayed.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"AreNotEqual(v1, v2 ",'[, "error message"]'," )"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Compares v1 to v2 and throws an exception if they are equal. If they are equal, the optional error string will be displayed.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"IsTrue(b1 ",'[, "error message"]'," )"),(0,o.kt)("td",{parentName:"tr",align:"left"},"If the Boolean b1 is not true it throws an exception. If not true, the optional error string will be displayed.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"IsFalse(b1 ",'[, "error message"]'," )"),(0,o.kt)("td",{parentName:"tr",align:"left"},"If the Boolean b1 is not false it throws an exception. If not false, the optional error string will be displayed.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"Fail(",'[ "error message"]'," )"),(0,o.kt)("td",{parentName:"tr",align:"left"},"This causes the test to fail and throws an exception. If called, the optional error string will be displayed.")))),(0,o.kt)("h2",{id:"accessing-the-software-under-test"},"Accessing the Software Under Test"),(0,o.kt)("p",null,"We have now created two projects in the same solution. The testing project needs access to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"the .lib or .obj file for the software under test,"),(0,o.kt)("li",{parentName:"ul"},"the header files for the project or modified header files if the project is in pure C.")),(0,o.kt)("p",null,"To make the project we are testing visible to the test code, we need to modify the values of the properties of the test project. You can do this by right clicking on the test project in the solution explorer and selecting properties. Once the properties are displayed, select ",(0,o.kt)("strong",{parentName:"p"},"Linker | General")," and then ",(0,o.kt)("strong",{parentName:"p"},"Additional Library Directories"),". This will display the dialog shown below."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"&quot;Dialog to set additional library directories.&quot; ",src:n(7169).Z})),(0,o.kt)("p",null,"The goal is to add the debug directory in the project under test. This should be two levels higher in the directory structure and then into the project under test. Start by clicking the symbol for a new directory at the left of the top series of buttons. This will create a new row into which you can type the directory. While you can use the threee dots to navigate, this will result in an absolute path which will make it difficult to move the project to a different location. A better way is to use the macro ",(0,o.kt)("strong",{parentName:"p"},"$(ProjectDir)")," which will be set to the directory containing the source code for the test project. If the project is moved, this macro will be automatically updated."),(0,o.kt)("p",null,"Next, we need to provide the name of the file(s) containing the compiled version of the software under test. If you just have an object file, like we do here, then you can just enter the name, ",(0,o.kt)("strong",{parentName:"p"},"mathfuncs.obj"),". If you had build a library, then you would enter the name of the library."),(0,o.kt)("p",null,"The final step is to tell the test project how to find the header files for the project being tested. If this is a C++ project we are testing then we navigate to ",(0,o.kt)("strong",{parentName:"p"},"C/C++ | General | Additional Include Directories")," and add the include directory for the project under test. If the project you are testing is pure C, then the process is more complicated."),(0,o.kt)("p",null,"C++ compilers alter names of functions inside classes so that they can determine the class that a particular method belongs to. C compilers do not do this, and this creates a problem when we are trying to link C++ code with pure C code. In order to get the two language is to be compiled together, we have to tell the C++ compiler which functions are actually pure C so that it will not alter the names of them, but just use the original names. The way we can do this, is to use the ",(0,o.kt)("strong",{parentName:"p"},"extern \u201cC\u201d")," declaration as demonstrated in the next piece of code."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'#pragma once\n#ifndef MATHFUNCS_R_H\n#define MATHFUNCS_R_H\n\nextern "C"\n{\n#include <mathfuncs.h>\n}\n\n#endif\n')),(0,o.kt)("p",null,"What I have done in this piece of code is to include the header file for the software under test inside an ",(0,o.kt)("strong",{parentName:"p"},"extern \u201cC\u201d")," block. This prevents the C compiler from altering the names and allows the two languages to be linked together. I called this file ",(0,o.kt)("strong",{parentName:"p"},"mathfuncs_r.h")," and placed it in the test project. The ",(0,o.kt)("strong",{parentName:"p"},"_","r")," is used to indicate it references the original header file. Next, you need to tell the test project where to find the header files for the project under test. This is done by editing the test project properties under ",(0,o.kt)("strong",{parentName:"p"},"C++ | General | Additional Include Directories"),". You should add paths to include the directories in which the header files are stored for the code you are testing, as well as the test project. Once done, the include paths should look like:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"&quot;Visual Studio Test Include Path&quot; ",src:n(698).Z})),(0,o.kt)("p",null,"The final step is to go the ",(0,o.kt)("strong",{parentName:"p"},"Build")," menu at the top and select ","*","Build All","*","*"," . You should ckeck the output window at the bottom to be sure that the solution compiled correctly. It should say that two projects were compiled and zero failed."),(0,o.kt)("h2",{id:"running-the-tests"},"Running the Tests"),(0,o.kt)("p",null,"The next step is to actually run the tests. Go to the ",(0,o.kt)("strong",{parentName:"p"},"Test")," menu at the top and select ",(0,o.kt)("strong",{parentName:"p"},"Test Explorer"),". This will display a new window to control the tests, as shown below. This wildow can be left floating or docked into the Visual Studio window."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"&quot;Visual Studio Test Explorer&quot; ",src:n(4305).Z})),(0,o.kt)("p",null,"The Test Explorer shows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"the list of tests,"),(0,o.kt)("li",{parentName:"ul"},"controls to run the tests,"),(0,o.kt)("li",{parentName:"ul"},"the number of tests available to run, the number passed, the number failed, and the number which have not been run,"),(0,o.kt)("li",{parentName:"ul"},"a sub-window at the right that will show the output of the tests.")),(0,o.kt)("p",null,"With the test explorer, you can highlight the test(s) you want to run and then press the ",(0,o.kt)("em",{parentName:"p"},"play")," button to run the tests. The results of the test are shown as you can see in the diagram below."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"&quot;Visual Studio Test Explorer showing results of a test.&quot; ",src:n(2758).Z})),(0,o.kt)("h2",{id:"setting-up-and-tearing-down-tests"},"Setting Up and Tearing Down Tests"),(0,o.kt)("p",null,"You can create additional functions to set up and tear down the tests. This would be needed if you required data structures to be set up before the tests were run and torn down after the tests were completed. There are functions for ",(0,o.kt)("strong",{parentName:"p"},"TEST_MODULE_INITIALIZE")," and ",(0,o.kt)("strong",{parentName:"p"},"TEST_MODULE_CLEANUP")," which are run before any of the class tests are run and after all class tests are complete. In addition, there are methods to go inside a test class called ",(0,o.kt)("strong",{parentName:"p"},"TEST_CLASS_INITIALIZE")," and ",(0,o.kt)("strong",{parentName:"p"},"TEST_CLASS_CLEANUP"),". These can be used to setup and tear down data structures required for each test class. There is a ",(0,o.kt)("strong",{parentName:"p"},"Logger")," class which is used to write simple messages to the test output. This is demonstrated in the code below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'#include "pch.h"\n#include "CppUnitTest.h"\n#include "mathfuncs_r.h"\n\nusing namespace Microsoft::VisualStudio::CppUnitTestFramework;\n\nnamespace MathTestSuite\n{\n    TEST_MODULE_INITIALIZE(ModuleInitialize)\n    {\n        Logger::WriteMessage("In Module Initialize");\n    }\n\n    TEST_MODULE_CLEANUP(ModuleCleanup)\n    {\n        Logger::WriteMessage("In Module Cleanup");\n    }\n\n    TEST_CLASS(MathTest)\n    {\n    public:\n        TEST_CLASS_INITIALIZE(ClassInitialize)\n        {\n            Logger::WriteMessage("In Class Initialize");\n        }\n\n        TEST_CLASS_CLEANUP(ClassCleanup)\n        {\n            Logger::WriteMessage("In Class Cleanup");\n        }\n\n        TEST_METHOD(SquareTest)\n        {\n            Logger::WriteMessage("In Square test");\n            double d = square(8.0);\n            Assert::AreEqual(64.0, d);\n        }\n\n        TEST_METHOD(CubeTest)\n        {\n            Logger::WriteMessage("In Cube test");\n            double d = cube(3.0);\n            Assert::AreEqual(27.0, d);\n        }\n    };\n\n    TEST_CLASS(MathIntegrationTest)\n    {\n    public:\n\n        TEST_METHOD(AdditionTest)\n        {\n            double d = square(8.0);\n            double d1 = cube(3.0);\n            Logger::WriteMessage("In Integration test");\n            Assert::AreEqual(91.0, d + d1);\n        }\n    };\n}\n')),(0,o.kt)("p",null,"We can run this code using the command ",(0,o.kt)("inlineCode",{parentName:"p"},"vstest.console.exe UnitTest1.dll"),". This command should be executed in a Windows cmd shell and will produce the output shown below. Note the order in which the initialize and cleanup functions are run."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"vstest.console.exe UnitTest1.dll\nMicrosoft (R) Test Execution Command Line Tool Version 16.11.0\nCopyright (c) Microsoft Corporation.  All rights reserved.\n\nStarting test execution, please wait...\nA total of 1 test files matched the specified pattern.\nIn Module Initialize\nIn Integration test\nIn Class Initialize\nIn Square test\nIn Cube test\nIn Class Cleanup\nIn Module Cleanup\n  Passed AdditionTest [< 1 ms]\n  Passed SquareTest [< 1 ms]\n  Passed CubeTest [< 1 ms]\n\nTest Run Successful.\nTotal tests: 3\n     Passed: 3\n Total time: 0.2394 Seconds\n")))}h.isMDXComponent=!0},7169:function(e,t,n){t.Z=n.p+"assets/images/vs-add-lib-dirs-cd8522e8535a68e765f2655a1943d5d1.jpg"},470:function(e,t,n){t.Z=n.p+"assets/images/vs-create-unit-project-f845770b53cb17423f81819f61b8659f.jpg"},2758:function(e,t,n){t.Z=n.p+"assets/images/vs-test-explorer-results-26a9fce28b92ec1ad494ce59cee5a32f.jpg"},4305:function(e,t,n){t.Z=n.p+"assets/images/vs-test-explorer-4ba01e6cf047a602a2e5f0ae5418391f.jpg"},698:function(e,t,n){t.Z=n.p+"assets/images/vs-test-include-0c8d6b5f1137ce798f90f6fbb5c72426.jpg"}}]);